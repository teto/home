#+title: how to use this repo
#+author: teto
#+NAME: demo

* home

This folder contains my customizations for:
- [[https://github.com/pazz/alot][alot]] (MUA: Mail User Agent, like mutt)
- [[https://github.com/astroidmail/astroid][astroid]] (MUA with a GUI)
- bash
- [[https://github.com/jarun/Buku][buku]]: a cli bookmark manager
- clerk (to control mpd via rofi)
- font handling font-manager
- fcitx (input method mechanims)
- git (Source control)
- greenclip (clipboard history, works with rofi, contender of roficlip)
- [[https://github.com/rycee/home-manager/][home-manager]]
- htop
- [[www.i3wm.org][i3]], a great if not the best tiling window manager)
- [[https://github.com/][i3pystatus]] (generates a status line for i3bar)
- [[https://github.com/pimutils/khard][khard]] (a carddav CLI)
- [[https://github.com/pimutils/khal][khal]] (a calendar CLI)
- mpd (configuration files to run this music server as a user)
- [[https://marlam.de/msmtp/news][msmtp]] (MSA: Mail Sending Agent)
- [[https://neomutt.org][neomutt]] (Mail User Agent)
- ncmpcpp (mpd console player)
- [[https://github.com/neovim/neovim][neovim]] (fork of vim)
- netrc (template only, password database)
- [[https://newsboat.org/][newboat]] (RSS reader, fork of newsbeuter)
- [[www.notmuch.org][notmuch]] (to tag mails)
- [[https://github.com/purebred-mua/purebred][purebred]] (terminal MUA)
- procmail
- [[qutebrowser][www.qutebrowser.org]] (vim like browser)
- [[https://github.com/ranger/ranger][ranger]] (CLI file explorer)
- [[https://github.com/DaveDavenport/rofi][rofi]] (a dmenu-like interactive prompt, works with clerk/i3 etc...)
- [[https://starship.rs/][starship]] (prompt manager)
- sxiv (image viewer)
- [[www.swaywm.com][sway]] (wayland window manager)
- [[https://github.com/thestinger/termite][termite]] (a modal terminal)
- [[https://github.com/jonas/tig][tig]] (a git history reader)
- tmux (terminal multiplexer)
- [[https://vifm.info/][vifm]] (ranger-like, file explorer)
- [[https://github.com/vimus/vimus][vimus]] (or vimpc ? mpd player)
- [[https://www.visidata.org/][visidata]] (for data analysis, csv/json/pcap/... reader)
- [[https://weechat.org/][weechat]] (Irc client)
- zsh (alternative to bash)

* nixos install
I have fully switched to [[NixOS][www.nixos.org]], which means that some of the
software configuration files are generated by nix.


* Install on nixos via flakes

#+BEGIN_SRC shell
nix registry add mine ~/nixpkgs
nix registry add nixpkgs github:teto/nixpkgs
nixos-rebuild switch --flake '.#' --use-remote-sudo
# when not setting #my-machine, defaults to hostname
nixos-rebuild switch --flake /path/to/my-flake#my-machine --use-remote-sudo
#+END_SRC

To build home-manager imperatively:
```nix
nix build .#whateverOutput.activationPackage
```
And then use the activation script in result/.


* How to transfer state

Some secrets can't be shared reliably on the repository so they need to be
transferred.

** How to transfer secrets from another machine

#+BEGIN_SRC
$ nix shell nixpkgs#magic-wormhole
$ wormhole send ~/.gnupg ~/.password-store ~/.ssh
#+END_SRC

** How to recover the repo cyphered files

Get git-crypt do decypher the files
Retreive the key (possibly from an existing deployement via `gpg-crypt export-key`) and use
it on the new deployement via:
`$ git-crypt unlock <key>` should unlock the files.

